---
import BaseLayout from "../../layouts/BaseLayout.astro";
import PostCard from "../../components/PostCard.astro";
import { getCollection } from "astro:content";

export async function getStaticPaths() {
  const posts = await getCollection("posts", ({ data }) => !data.draft);
  const set = new Set<string>();
  posts.forEach(p => (p.data.tags ?? []).forEach(t => set.add(t)));
  return Array.from(set).map((t) => ({ params: { tag: t } }));
}

const { tag } = Astro.params;
const posts = await getCollection("posts", ({ data }) => !data.draft && (data.tags ?? []).includes(tag!));
---

<BaseLayout title={`#${tag} | hawks.tw`}>
  <h1 class="text-2xl font-bold mb-4">#{tag}</h1>
  <section class="space-y-4">
    {posts.map((p) => <PostCard entry={p} />)}
  </section>
</BaseLayout>
